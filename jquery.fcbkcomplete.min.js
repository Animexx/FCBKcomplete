(function(a,b){a.fn.fcbkcomplete=function(c){return this.queue(function(){function J(){g();p(0)}function g(){K=a('<ul class="holder"></ul>');if(B.attachto){if(typeof(B.attachto)=="object"){B.attachto.append(K)}else{a(B.attachto).append(K)}}else{q.after(K)}r=a('<div class="facebook-auto">');if(B.complete_text!=""){r.append('<div class="default">'+B.complete_text+"</div>")}r.hover(function(){E=0},function(){E=1});h=a('<ul id="'+f+'_feed"></ul>');K.after(r.prepend(h));h.css("width",r.width());t()}function t(){name=q.attr("name");if(B.bricket){if(name.indexOf("[]")==-1){name=name+"[]"}}var P=a("<"+q.get(0).tagName+' name="'+name+'" id="'+f+'" multiple="multiple" class="'+q.get(0).className+' hidden">');a.each(q.children("option"),function(Q,R){R=a(R);P.data(R.val(),R.text());if(R.hasClass("selected")){var S=L(R.text(),R.val(),true,R.hasClass("locked"));if(S!==false){P.append('<option value="'+R.val()+'" selected="selected" id="opt_'+S+'"class="selected">'+R.text()+"</option>")}}});q.after(P);q.remove();q=P;a(q).bind("addItem",function(Q,R){L(R.title,R.value,0,0,0)});a(q).bind("removeItem",function(R,S){var Q=K.children("li[rel="+S.value+"]");if(Q.length){l(Q)}});a(q).bind("destroy",function(Q,R){K.remove();r.remove();q.show()})}function L(Y,Z,V,U,ab){if(!I()){return false}if(B.prevent_empty_elements&&Z==""){return false}if(B.comma_separator&&B.newel){var P=Z.split(",");if(P.length>1){for(var T=0;T<P.length;T++){L(a.trim(P[T]),a.trim(P[T]),V,U,ab)}return false}}if(B.prevent_duplicate_elements&&q.find('option[value="'+s(Z,1)+'"]').length>0&&!V){a("#"+f+"_annoninput").remove();p(ab);return false}var R="bit-box"+(U?" locked":"");var Q=C();var S=document.createTextNode(s(Y));var X=a('<a class="closebutton" href="#"></a>');var aa=a('<li class="'+R+'" rel="'+Z+'" id="pt_'+Q+'"></li>').prepend(S).append(X);K.append(aa);X.click(function(){l(a(this).parent("li"));return false});if(!V){a("#"+f+"_annoninput").remove();p(ab);var W=a('<option value="'+s(Z,1)+'" id="opt_'+Q+'" class="selected" selected="selected">'+s(Y)+"</option>");q.append(W);if(B.onselect){x(B.onselect,W)}if(B.onchange){x(B.onchange,W)}q.change()}K.children("li.bit-box.deleted").removeClass("deleted");h.hide();return Q}function l(Q){if(!Q.hasClass("locked")){Q.fadeOut("fast");var R=Q.attr("id");if(B.onremove){var P=R?a("#o"+R+""):q.children("option[value="+Q.attr("rel")+"]");x(B.onremove,P)}if(R){a("#o"+R+"").remove()}else{q.children('option[value="'+Q.attr("rel")+'"]').remove()}if(B.onchange){x(B.onchange,Q)}Q.remove();q.change();D=0}}function p(Q){var P=a('<li class="bit-input" id="'+f+'_annoninput">');var R=a('<input type="text" class="maininput" size="'+B.input_min_size+'" autocomplete="off">');if(B.input_tabindex>0){R.attr("tabindex",B.input_tabindex)}if(B.input_name!=""){R.attr("name",B.input_name)}var S=0;K.append(P.append(R));R.focus(function(){u=true;if(I()){r.fadeIn("fast")}});R.blur(function(){u=false;if(E){r.fadeOut("fast")}else{R.focus()}});K.click(function(){R.focus();if(h.length&&R.val().length){h.show()}else{h.hide();r.children(".default").show()}});R.keypress(function(U){if(U.keyCode==v.enter){return false}var T=R.val().length+1;if(B.input_min_size>T){T=B.input_min_size}R.attr("size",T)});R.keydown(function(T){if(O(T.keyCode)){return d(T,a(this))}});R.keyup(function(T){var V=N(R.val(),1);if(T.keyCode==v.backspace&&V.length==0){h.hide();if(!K.children("li.bit-box:last").hasClass("locked")){if(K.children("li.bit-box.deleted").length==0){K.children("li.bit-box:last").addClass("deleted");return false}else{if(D){return}D=1;K.children("li.bit-box.deleted").fadeOut("fast",function(){l(a(this));return false})}}}if(T.keyCode!=v.downarrow&&T.keyCode!=v.uparrow&&T.keyCode!=v.leftarrow&&T.keyCode!=v.rightarrow&&V.length!=0){e=0;G=null;if(B.json_url&&I()){if(B.cache&&m.get(V)){j(V);M()}else{S++;var U=S;setTimeout(function(){if(U!=S){return}a.getJSON(B.json_url,{tag:s(V)},function(X){if(!u){return}var W=N(R.val(),1);if(W!=V){return}j(V,X);m.set(V,1);M()})},B.delay)}}else{j(V);M()}r.children(".default").hide();h.show()}});if(Q){setTimeout(function(){R.focus();r.children(".default").show()},1)}}function j(S,Q){h.html("");if(!B.cache&&Q!=null){n.clear()}k(S);if(Q!=null&&Q.length){a.each(Q,function(T,U){n.set(N(U.key),N(U.value))})}var R=B.maxshownitems<n.length()?B.maxshownitems:n.length();var P="";a.each(n.search(S),function(U,T){if(B.filter_selected&&q.children("option[value="+T.key+"]").hasClass("selected")){}else{P+='<li rel="'+T.key+'">'+s(H(T.value,S))+"</li>";e++;R--}});h.append(P);if(B.firstselected){G=h.children("li:visible:first");G.addClass("auto-focus")}if(e>B.height){h.css({height:(B.height*24)+"px",overflow:"auto"})}else{h.css("height","auto")}if(I()&&r.is(":hidden")){r.show()}}function H(T,V){var S=B.filter_begin?"":"(.*)";var P=B.filter_begin?"<em>$1</em>$2":"$1<em>$2</em>$3";var U=S+(B.filter_case?"("+V+")(.*)":"("+V.toLowerCase()+")(.*)");try{var R=new RegExp(U,((B.filter_case)?"g":"gi"));var T=T.replace(R,P)}catch(Q){}return T}function w(){h.children("li").mouseover(function(){h.children("li").removeClass("auto-focus");G=a(this);G.addClass("auto-focus")});h.children("li").mouseout(function(){a(this).removeClass("auto-focus");G=null})}function z(){h.unbind("mouseover").unbind("mouseout").mousemove(function(){w();h.unbind("mousemove")})}function O(P){if(P==v.enter||P==v.tab){return true}if(P==v.comma&&B.comma_separator){return true}}function d(P,S){if(B.prevent_empty_elements&&S.val()==""){if(P.keyCode==v.tab&&B.tab_leaves_input){return true}else{P.preventDefault()}}if(y()){var R=G.text();var Q=G.attr("rel")}else{var R=N(S.val());var Q=R}if(P.keyCode==v.tab&&B.tab_leaves_input){if(B.newel&&B.addontab){window.setTimeout(function(){L(R,Q,0,0,0)},1)}}else{if(B.newel&&B.addontab){L(R,Q,0,0,1)}F(P)}}function M(){var P=a("#"+f+"_annoninput").children(".maininput");w();h.children("li").unbind("mousedown").mousedown(function(){var Q=a(this);L(Q.text(),Q.attr("rel"),0,0,1);h.hide();r.hide()});P.unbind("keydown");P.keydown(function(Q){if(Q.keyCode!=v.backspace){K.children("li.bit-box.deleted").removeClass("deleted")}if(O(Q.keyCode)){return d(Q,a(this))}if(Q.keyCode==v.downarrow){A("first")}if(Q.keyCode==v.uparrow){A("last")}})}function A(P){z();if(G==null||G.length==0){G=h.children("li:visible:"+P);h.get(0).scrollTop=P=="first"?0:parseInt(G.get(0).scrollHeight,10)*(parseInt(h.children("li:visible").length,10)-Math.round(B.height/2))}else{G.removeClass("auto-focus");G=P=="first"?G.nextAll("li:visible:first"):G.prevAll("li:visible:first");var R=parseInt(G.prevAll("li:visible").length,10);var Q=parseInt(G.nextAll("li:visible").length,10);if(((P=="first"?R:Q)>Math.round(B.height/2)||(P=="first"?R:Q)<=Math.round(B.height/2))&&typeof(G.get(0))!="undefined"){h.get(0).scrollTop=parseInt(G.get(0).scrollHeight,10)*(R-Math.round(B.height/2))}}h.children("li").removeClass("auto-focus");G.addClass("auto-focus")}function F(P){r.hide();P.preventDefault();G=null;return false}function I(){return B.maxitems!=0&&(K.children("li.bit-box").length<B.maxitems)}function k(Q){if(B.newel&&I()){h.children("li[fckb=1]").remove();if(Q.length==0){return}var P=a('<li rel="'+Q+'" fckb="1"">').html(s(Q));h.prepend(P);e++}return}function x(Q,P){var R={};for(i=0;i<P.get(0).attributes.length;i++){if(P.get(0).attributes[i].nodeValue!=null){R["_"+P.get(0).attributes[i].nodeName]=P.get(0).attributes[i].nodeValue}}return Q.call(Q,R)}function y(){if(G==null||G.length==0){return false}return true}function N(Q,P){if(typeof P!="undefined"){for(i=0;i<Q.length;i++){var R=Q.charCodeAt(i);if((v.exclamation<=R&&R<=v.slash&&R!=v.comma_cc)||(v.colon<=R&&R<=v.at)||(v.squarebricket_left<=R&&R<=v.apostrof)){Q=Q.replace(Q[i],escape(Q[i]))}}Q=Q.replace(/(\{|\}|\*)/i,"\\$1")}return Q.replace(/script(.*)/g,"")}function s(Q,P){Q=Q.toString();Q=Q.replace("\\","");if(typeof P!="undefined"){return Q}return unescape(Q)}var B=a.extend({json_url:null,cache:false,height:"10",newel:false,addontab:false,firstselected:false,filter_case:false,filter_selected:false,filter_begin:false,complete_text:"Start to type...",maxshownitems:30,maxitems:10,onselect:null,onchange:null,onremove:null,attachto:null,delay:350,input_tabindex:0,input_min_size:1,input_name:"",tab_leaves_input:false,comma_separator:false,prevent_empty_elements:false,prevent_duplicate_elements:false,bricket:true},c);var K=null;var h=null;var r=null;var e=0;var u=false;var G=null;var D=0;var E=1;var q=a(this);var f=q.attr("id");var o=a("<div></div>").after(q);var m={set:function(Q,P){o.data(Q,P)},get:function(P){return o.data(P)}};var v={enter:13,tab:9,backspace:8,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,exclamation:33,slash:47,colon:58,at:64,squarebricket_left:91,apostrof:96,comma:188,comma_cc:44};var C=function(){var S="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var R="";for(var Q=0;Q<32;Q++){var P=Math.floor(Math.random()*S.length);R+=S.substring(P,P+1)}return R};var n={search:function(R,S){var P=new Array();var Q=new RegExp((B.filter_begin?"^":"")+R,(B.filter_case?"g":"gi"));a.each(q.data(),function(U,T){if(typeof T.search==="function"){if(T.search(Q)!=-1){P.push({key:U,value:T})}}});return P},set:function(Q,P){q.data(Q,P)},get:function(P){return q.data(P)},clear:function(){q.removeData()},length:function(){var Q=0;for(var P in this){if(this.hasOwnProperty(P)){++Q}}return Q}};J();return this})}})(jQuery);